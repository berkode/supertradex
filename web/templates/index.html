<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Coin Trading Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        .chart-container {
            height: 500px;
            margin-bottom: 20px;
        }
        .metrics-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .update-interval {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">Meme Coin Trading Platform</h1>
        
        <!-- Control Panel -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Control Panel</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <button class="btn btn-primary w-100 mb-2" onclick="scanTokens()">Scan Tokens</button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-success w-100 mb-2" onclick="startTrading()">Start Trading</button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-warning w-100 mb-2" onclick="startPaperTrading()">Paper Trading</button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-info w-100 mb-2" onclick="startBacktesting()">Backtesting</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Update Interval -->
        <div class="update-interval">
            <select class="form-select" id="updateInterval" onchange="updateInterval()">
                <option value="1s">1 Second</option>
                <option value="5s">5 Seconds</option>
                <option value="15s">15 Seconds</option>
                <option value="1m">1 Minute</option>
                <option value="5m">5 Minutes</option>
                <option value="15m">15 Minutes</option>
                <option value="1h">1 Hour</option>
                <option value="6h">6 Hours</option>
                <option value="24h">24 Hours</option>
            </select>
        </div>
        
        <!-- TradingView Chart -->
        <div class="chart-container">
            <div id="tradingview_chart"></div>
        </div>
        
        <!-- Metrics -->
        <div class="metrics-container">
            <h4>Live Metrics</h4>
            <div class="row" id="metrics">
                <!-- Metrics will be updated here -->
            </div>
        </div>
        
        <!-- Trade History -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Trade History</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table" id="tradeHistory">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Token</th>
                                <th>Type</th>
                                <th>Price</th>
                                <th>Volume</th>
                                <th>Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Trade history will be updated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Socket.IO
        const socket = io();
        
        // Initialize TradingView widget
        new TradingView.widget({
            "autosize": true,
            "symbol": "SOLANA:YOUR_TOKEN",
            "interval": "1",
            "timezone": "exchange",
            "theme": "light",
            "style": "1",
            "locale": "en",
            "toolbar_bg": "#f1f3f6",
            "enable_publishing": false,
            "allow_symbol_change": true,
            "container_id": "tradingview_chart"
        });
        
        // Socket event handlers
        socket.on('price_update', function(data) {
            updateMetrics(data);
            updateTradeHistory(data);
        });
        
        // Update metrics display
        function updateMetrics(data) {
            const metricsHtml = `
                <div class="col-md-3">
                    <h6>Price</h6>
                    <p>${data.data.price}</p>
                </div>
                <div class="col-md-3">
                    <h6>Volume</h6>
                    <p>${data.data.volume}</p>
                </div>
                <div class="col-md-3">
                    <h6>24h Change</h6>
                    <p>${data.data.price_change_24h}%</p>
                </div>
                <div class="col-md-3">
                    <h6>Volatility</h6>
                    <p>${data.data.volatility}%</p>
                </div>
            `;
            document.getElementById('metrics').innerHTML = metricsHtml;
        }
        
        // Update trade history
        function updateTradeHistory(data) {
            const row = `
                <tr>
                    <td>${new Date(data.timestamp).toLocaleString()}</td>
                    <td>${data.token}</td>
                    <td>${data.data.signal > 0 ? 'Buy' : 'Sell'}</td>
                    <td>${data.data.price}</td>
                    <td>${data.data.volume}</td>
                    <td>${data.data.profit || '-'}</td>
                </tr>
            `;
            document.querySelector('#tradeHistory tbody').insertAdjacentHTML('afterbegin', row);
        }
        
        // Control functions
        function scanTokens() {
            fetch('/scan_tokens', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => alert(data.message));
        }
        
        function startTrading() {
            const tokenAddress = prompt('Enter token address:');
            if (tokenAddress) {
                fetch('/start_trading', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ token_address: tokenAddress })
                })
                .then(response => response.json())
                .then(data => alert(data.message));
            }
        }
        
        function startPaperTrading() {
            const tokenAddress = prompt('Enter token address:');
            if (tokenAddress) {
                fetch('/start_paper_trading', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ token_address: tokenAddress })
                })
                .then(response => response.json())
                .then(data => alert(data.message));
            }
        }
        
        function startBacktesting() {
            const tokenAddress = prompt('Enter token address:');
            const startDate = prompt('Enter start date (YYYY-MM-DD):');
            const endDate = prompt('Enter end date (YYYY-MM-DD):');
            
            if (tokenAddress && startDate && endDate) {
                fetch('/start_backtesting', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        token_address: tokenAddress,
                        start_date: startDate,
                        end_date: endDate
                    })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.results_path) {
                        window.open(data.results_path, '_blank');
                    }
                });
            }
        }
        
        function updateInterval() {
            const interval = document.getElementById('updateInterval').value;
            fetch('/update_interval', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ interval: interval })
            })
            .then(response => response.json())
            .then(data => alert(data.message));
        }
    </script>
</body>
</html> 